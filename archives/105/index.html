<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,ç†ŠçŒ«å°A,Galileo,blog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Prism" />
    <link rel="alternate" type="application/rss+xml" title="æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’ &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’ &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/prism-b9d78ff38a.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/ExSearch/ExSearch-182e5a8869.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/993aa3dcb70943b3e506b13b3d502541.json"
        }

    </script>
    
<title>CUDA ä¸­çš„æ•°ç»„(Array)ä¸çº¹ç†å­˜å‚¨(Texture)ä»‹ç»ä¸ä½¿ç”¨ - æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’</title>
<meta name="author" content="ç†ŠçŒ«å°A" />
<meta name="description" content="è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ç§å­˜å‚¨å™¨ï¼šçº¹ç†å­˜å‚¨å™¨ï¼ˆTexture Memoryï¼‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒåŠ é€Ÿè®¿é—®çº¿æ€§å†…å­˜ä¸ CUDA æ•°ç»„ï¼ˆArrayï¼‰ã€‚" />
<meta property="og:title" content="CUDA ä¸­çš„æ•°ç»„(Array)ä¸çº¹ç†å­˜å‚¨(Texture)ä»‹ç»ä¸ä½¿ç”¨ - æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’" />
<meta property="og:description" content="è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ç§å­˜å‚¨å™¨ï¼šçº¹ç†å­˜å‚¨å™¨ï¼ˆTexture Memoryï¼‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒåŠ é€Ÿè®¿é—®çº¿æ€§å†…å­˜ä¸ CUDA æ•°ç»„ï¼ˆArrayï¼‰ã€‚" />
<meta property="og:site_name" content="æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/105/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2018-04-19T10:34:00-00.00" />
<meta name="twitter:title" content="CUDA ä¸­çš„æ•°ç»„(Array)ä¸çº¹ç†å­˜å‚¨(Texture)ä»‹ç»ä¸ä½¿ç”¨ - æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’" />
<meta name="twitter:description" content="è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ç§å­˜å‚¨å™¨ï¼šçº¹ç†å­˜å‚¨å™¨ï¼ˆTexture Memoryï¼‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒåŠ é€Ÿè®¿é—®çº¿æ€§å†…å­˜ä¸ CUDA æ•°ç»„ï¼ˆArrayï¼‰ã€‚" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />
<link rel="dns-prefetch" href="//blog.imalan.cn" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/brand_font/embed.css" />
<style>.brand{font-family:FZCuJinLFW,serif;font-weight: normal!important;}</style>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/apple-touch-icon.png?v=PY43YeeEKx">
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/favicon-32x32.png?v=yyLyaqbyRG">
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/favicon-16x16.png?v=yyLyaqbyRG">
<link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/safari-pinned-tab.svg?v=yyLyaqbyRG" color="#505050">
<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/favicon.ico?v=yyLyaqbyRG">
<meta name="application-name" content="ä¸‰ç„¡è¨ˆåŠƒ">
<meta name="apple-mobile-web-app-title" content="ä¸‰ç„¡è¨ˆåŠƒ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="theme-color" content="#000000">
<meta name="baidu-site-verification" content="9BEwwo6Ibg" />

</head>

<body>
    <div class="container prism-container">
        <header class="prism-header" id="prism__header">
            <h1 class="text-uppercase brand"><a class="no-link" href="/" target="_self">æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’</a></h1>
            <p>åªåšæŒä¸€ç§æ­£ä¹‰ã€‚æˆ‘çš„æ­£ä¹‰ã€‚</p>
            <nav class="prism-nav"><ul><li><a class="no-link text-uppercase " href="/" target="_self">é¦–é¡µ</a></li><li><a class="no-link text-uppercase " href="/archives/" target="_self">å½’æ¡£</a></li><li><a class="no-link text-uppercase " href="/links/" target="_self">å‹é“¾</a></li><li><a class="no-link text-uppercase " href="/about/" target="_self">å…³äº</a></li><li><a href="#" target="_self" class="search-form-input no-link text-uppercase">æœç´¢</a></li></ul></nav>
        </header>
        <div class="prism-wrapper" id="prism__wrapper">
            
<main>
    <section class="prism-section row" id="prism__content">
        <article class="yue col-md-8 offset-md-2">
            <h1 class="prism-post-title">CUDA ä¸­çš„æ•°ç»„(Array)ä¸çº¹ç†å­˜å‚¨(Texture)ä»‹ç»ä¸ä½¿ç”¨</h1>
            <div class="prism-post-time">
                <time class="text-uppercase">
                    April 19 2018
                </time>
            </div>
            <div class="prism-content-body">
                <p>CUDA ä¸­æœ‰ä¸åŒçš„å†…å­˜ç±»å‹ï¼ŒåŒ…æ‹¬å…¨å±€å­˜å‚¨ï¼ˆGlobal Memoryï¼‰ã€å…±äº«å­˜å‚¨ï¼ˆShared Memoryï¼‰ã€å¸¸æ•°å­˜å‚¨å™¨ï¼ˆConstant Memoryï¼‰ã€å¯„å­˜å™¨ï¼ˆRegisterï¼‰ç­‰ã€‚è¿™äº›ä¸åŒç±»å‹çš„å­˜å‚¨å™¨åœ¨ç‰©ç†ä½ç½®ã€è®¿é—®æ•ˆç‡ä¸Šå„æœ‰ä¸åŒï¼Œå› æ­¤é€‚åˆä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œè¿™é‡Œä¸å±•å¼€ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸€ç§å­˜å‚¨å™¨ï¼šçº¹ç†å­˜å‚¨å™¨ï¼ˆTexture Memoryï¼‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒåŠ é€Ÿè®¿é—®çº¿æ€§å†…å­˜ä¸ CUDA æ•°ç»„ï¼ˆArrayï¼‰ã€‚</p>
<p><em>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ªç½‘ç»œï¼Œæˆ‘åšäº†ä¸€äº›è°ƒæ•´ï¼ŒåŠ äº†ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ç»å¸¸è§£å†³äº†ä¸€ä¸ªé—®é¢˜ä¹‹åä¸‹æ¬¡åˆç¢°åˆ°ä¸€æ ·çš„é—®é¢˜ï¼Œç„¶ååˆæ˜¯ä¸€ç¿»æœå¯»ã€‚åœ¨é‚£ç§æ—¶å€™æˆ‘æ€»æ˜¯ä¼šæƒ³ï¼šâ€œæˆ‘å½“æ—¶æœ‰å†™æ–‡ç« å°±å¥½äº†â€ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿˜æ˜¯æŠŠå¹³æ—¥é‡Œé‡åˆ°çš„å°é—®é¢˜ã€çœ‹åˆ°çš„å¥½æ–‡ç« éƒ½æ•´ç†æ•´ç†æ€»ç»“æ€»ç»“ï¼Œç§¯å°‘æˆå¤šï¼Œå¯¹ç²¾è¿›æŠ€æœ¯åº”è¯¥ä¼šæœ‰å¸®åŠ©ã€‚</em></p>
<h2>çº¹ç†å­˜å‚¨å™¨ï¼ˆTexture Memoryï¼‰</h2>
<h3>çº¹ç†å­˜å‚¨å™¨æ˜¯ä»€ä¹ˆ</h3>
<p>é¦–å…ˆæ˜ç¡®ï¼šçº¹ç†å­˜å‚¨å™¨æ˜¯ä¸€ç§åªè¯»å­˜å‚¨å™¨ï¼Œç”± GPU ç”¨äºçº¹ç†æ¸²æŸ“çš„å›¾å½¢ä¸“ç”¨å•å…ƒå‘å±•è€Œæ¥ã€‚å®ƒåŒæ ·ä½äºæ˜¾å­˜ä¸­ï¼Œä½†æ˜¯åœ¨è®¿é—®æ—¶æœ‰è®¸å¤šä¼˜ç§€çš„ç‰¹æ€§ï¼Œä¾‹å¦‚å¯é€šè¿‡çº¹ç†ç¼“å­˜åŠ é€Ÿè¯»å–ã€‚ç›¸å¯¹åŒæ ·å…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å¸¸æ•°å­˜å‚¨å™¨ï¼ˆConstant Memoryï¼‰ï¼Œçº¹ç†å­˜å‚¨å™¨å¯ä»¥ç»‘å®šæ›´å¤§çš„æ•°æ®ï¼Œå¹¶ä¸”æ”¯æŒä¸€ç»´ã€äºŒç»´ã€ä¸‰ç»´çº¹ç†ï¼Œå¹¶å¯ä»¥é€šè¿‡æµ®ç‚¹æ•°å¯»å€ã€‚ç”±äºçº¹ç†å­˜å‚¨å™¨è½¬ä¸ºå›¾åƒçº¹ç†æ¸²æŸ“è€Œè®¾è®¡ï¼Œå®ƒç‰¹åˆ«é€‚åˆå›¾åƒå¤„ç†ã€æŸ¥æ‰¾è¡¨ç­‰ï¼Œå¯¹éšæœºè®¿é—®ä¸éå¯¹é½è®¿é—®æœ‰è‰¯å¥½çš„åŠ é€Ÿæ•ˆæœï¼Œå¹¶ä¸”å¯ä»¥æŒ‰éœ€åœ¨è¿”å›æ—¶åŒæ—¶è¿›è¡Œæ»¤æ³¢ç­‰æ“ä½œã€‚ä¸€ä¸ªå¾ˆç›´è§‚çš„ä¾‹å­ï¼Œä¸‹é¢çš„çŸ©é˜µä¸­ 1,2,3,4 å››ä¸ªæ•°æ®åœ¨è¡Œä¼˜å…ˆçš„çº¿æ€§å­˜å‚¨ä¸­å¹¶ä¸å…·æœ‰ç›¸é‚»çš„ç‰©ç†åœ°å€ï¼Œå› æ­¤è¿ç»­ç´¢å¼•è¿™äº›æ•°æ®æ•ˆç‡æ˜¯ä½ä¸‹çš„ï¼›ä½†æ˜¯çº¹ç†å­˜å‚¨å¯ä»¥åœ¨è¯»å–å…¶ä¸­æŸä¸ªæ•°æ®æ—¶å°†ä¸´è¿‘çš„å€¼è½½å…¥ç¼“å­˜ï¼ˆCacheï¼‰ï¼Œè¿™æ ·ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œåˆ™å¯ä»¥ç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œå‡å°‘å¯¹ Global Memory çš„è®¿é—®ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p>
<p><figure class="pswp-item" style="flex: 50.27075812274368" data-width="557" data-height="554"><img src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/archives/assets/482033fc1e4efd3fbcc0e94674d2f969.png" alt="textures_cuda" /><figcaption>textures_cuda</figcaption></figure></p>
<p>å¯¹ç¨‹åºå‘˜æ¥è¯´ï¼Œçº¹ç†å­˜å‚¨æ˜¯é€æ˜çš„ï¼Œç¨‹åºå‘˜æ— éœ€å…³å¿ƒå†…éƒ¨å®ç°ã€‚</p>
<p>åœ¨ CUDA å†…æ ¸å‡½æ•°ï¼ˆKernel Codeï¼‰ä¸­è®¿é—®çº¹ç†å­˜å‚¨å™¨ç§°ä½œçº¹ç†æ‹¾å–ï¼ˆTexture Fetchingï¼‰ï¼Œä½œä¸ºçº¹ç†å­˜å‚¨çš„ç‰¹æ€§ï¼Œçº¹ç†æ‹¾å–ä¸æ™®é€šçš„è®¿é—®æŸä¸€æ˜¾å­˜åœ°å€çš„æ•°æ®æœ‰å¾ˆå¤§ä¸åŒã€‚çº¹ç†æ‹¾å–æ—¶é‡‡ç”¨çš„åæ ‡å¯ä»¥ä¸åŒäºæ•°æ®åœ¨å­˜å‚¨ä¸­çš„çœŸå®åœ°å€ï¼ŒäºŒè€…é—´çš„è½¬æ¢é€šè¿‡çº¹ç†å‚ç…§ç³»ï¼ˆTexture Referenceï¼‰æ¥çº¦å®šï¼Œå°†æ˜¾å­˜ä¸­çš„æ•°æ®ä¸çº¦å®šçš„çº¹ç†å‚ç…§ç³»å…³è”çš„æ“ä½œç§°ä¸ºçº¹ç†ç»‘å®šï¼ˆTexture Bindingï¼‰ã€‚å¯ä»¥ä¸çº¹ç†ç»‘å®šçš„æ•°æ®æœ‰ä¸¤ç§ï¼šæ˜¾å­˜ä¸­çš„çº¿æ€§å†…å­˜ï¼ˆLinear Memoryï¼‰å’ŒCUDAæ•°ç»„ï¼ˆArrayï¼‰ã€‚çº¿æ€§å†…å­˜åªèƒ½ä¸ä¸€ç»´çº¹ç†ç»‘å®šï¼ŒCUDA æ•°ç»„åˆ™å¯ç»‘å®šä¸€ç»´ã€äºŒç»´ã€ä¸‰ç»´çº¹ç†ã€‚</p>
<p>å…³äºçº¹ç†ç¼“å­˜ï¼Œå®ƒæœ‰ä¸¤ä¸ªä½œç”¨ã€‚é¦–å…ˆçº¹ç†ç¼“å­˜ä¸­çš„æ•°æ®å¯è¢«å¤ç”¨ï¼Œå½“è®¿é—®çš„æ•°æ®å·²ç»ä½äºç¼“å­˜ä¸­æ—¶ï¼Œè®¿é—®è¯¥æ•°æ®å°†å‘½ä¸­ç¼“å­˜ï¼Œå‡å°‘å¯¹ Global Memory çš„è®¿é—®ï¼›å…¶æ¬¡çº¹ç†å­˜å‚¨å¯ä»¥å°†æ‹¾å–åæ ‡é™„è¿‘çš„å‡ ä¸ªåƒå…ƒç¼“å­˜èµ·æ¥ï¼Œå¹¶å¯ä»¥åœ¨æ‹¾å–æ—¶è¿›è¡Œæ’å€¼ã€‚</p>
<p>å…³äºçº¹ç†ç¼“å­˜éœ€è¦æ³¨æ„çš„ç‚¹ï¼šç”±äºçº¹ç†ç¼“å­˜æ˜¯åªè¯»çš„ï¼Œå¦‚æœä½ æ›´æ”¹äº†ç»‘å®šåˆ°çº¹ç†ç¼“å­˜çš„æ•°æ®ï¼Œçº¹ç†ç¼“å­˜ä¸­çš„æ•°æ®å¯èƒ½å¹¶æ²¡æœ‰è¢«æ›´æ–°ï¼Œæ­¤æ—¶æ‹¾å–åˆ°çš„å¯èƒ½æ˜¯é”™è¯¯çš„æ•°æ®ã€‚å› æ­¤æ¯æ¬¡ä¿®æ”¹åŸå§‹æ•°æ®éƒ½è¦é‡æ–°ç»‘å®šã€‚å¯¹ç»‘å®š CUDA æ•°ç»„æ—¶ä¸å­˜åœ¨æ­¤é—®é¢˜ï¼ˆDevice ç«¯ CUDA æ•°ç»„æ˜¯åªè¯»çš„ï¼‰ï¼Œä½†ç»‘å®šçº¿æ€§å†…å­˜åˆ™è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
<h3>çº¹ç†æ‹¾å–ï¼ˆTexture Fetchingï¼‰</h3>
<p>è®¿é—®çº¹ç†ä¸­çš„æ•°æ®çš„è¿‡ç¨‹ç§°ä½œçº¹ç†æ‹¾å–ã€‚å¯¹ç»‘å®šçº¿æ€§å†…å­˜çš„çº¹ç†ï¼Œæ‹¾å–çº¹ç†çš„åæ ‡åªèƒ½æ˜¯å®šç‚¹å‹ã€åæ ‡ä¸å†…å­˜çš„çœŸå®åç§»é‡ï¼ˆOffsetï¼‰ç›¸åŒã€‚å¯¹ç»‘å®š CUDA æ•°ç»„çš„çº¹ç†ï¼Œæ‹¾å–åæ ‡æ˜¯æµ®ç‚¹å‹ï¼Œå¹¶æ”¯æŒè®¸å¤šç‰¹æ®ŠåŠŸèƒ½ã€‚</p>
<p><strong>æµ®ç‚¹å½¢å¼å¯»å€ï¼š</strong>è®¿é—®æ—¶é‡‡ç”¨æµ®ç‚¹å‹çš„åæ ‡å¯¹çº¹ç†è¿›è¡Œå¯»å€ï¼Œä¹Ÿå°±æ˜¯è¯´åæ ‡æ— éœ€æ˜¯æ•´æ•°ã€‚å¯»å€çš„æ–¹å¼å¯ä»¥ä½¿å½’ä¸€åŒ–æˆ–è€…éå½’ä¸€åŒ–çš„ã€‚å¯¹ä¸€ä¸ªåæ ‡èŒƒå›´æ˜¯ [0:N]*[0:N] çš„çº¹ç†ï¼Œå½“ä½¿ç”¨å½’ä¸€åŒ–çš„å¯»å€æ–¹å¼æ—¶ï¼Œæ¯ä¸ªç»´åº¦ä¸Šçš„åæ ‡è¢«æ˜ å°„åˆ° [0.0:1.0f) çš„èŒƒå›´ä¸­ï¼›ä½¿ç”¨éå½’ä¸€åŒ–å¯»å€æ—¶ï¼Œå°†è¢«æ˜ å°„åˆ° [0.0:N.0f) çš„èŒƒå›´å†…ã€‚å½“è®¿é—®çš„åæ ‡ä¸åœ¨ä¸€ä¸ªåƒå…ƒçš„ä¸­å¿ƒæ—¶ï¼Œæ ¹æ®é€‰æ‹©çš„æ»¤æ³¢æ¨¡å¼ä¸åŒï¼Œå°†è¿”å›ä¸åŒçš„å€¼ã€‚</p>
<p><strong>æ»¤æ³¢æ¨¡å¼ï¼š</strong>ä»…å¯¹ç»‘å®š CUDA æ•°ç»„çš„çº¹ç†æœ‰æ•ˆã€‚å½“ä½¿ç”¨æµ®ç‚¹å‹çš„åæ ‡å¯»å€çº¹ç†æ—¶ï¼Œå°†æ ¹æ®è®¾å®šè¿”å›ä¸åŒç±»å‹çš„å€¼ã€‚è®¾å®šå¯ä»¥æœ‰ï¼šæœ€é‚»è¿‘å–æ ·æ¨¡å¼ï¼ˆ<strong>è¿™é‡Œå­˜ç–‘ï¼Œå› ä¸ºæˆ‘è‡ªå·±è¯•äº†ä¸€ä¸‹ä¼¼ä¹ä¹Ÿä¸æ˜¯æœ€è¿‘é‚»ï¼Œè€Œæ˜¯ç›´æ¥å¯¹åæ ‡å– floor</strong>ï¼‰å’Œçº¿æ€§æ»¤æ³¢æ¨¡å¼ï¼Œè¿™æ— éœ€å¤šè¯´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å¼€å¯äº†çº¿æ€§æ»¤æ³¢æ¨¡å¼æ—¶ï¼Œè¦å¯¹è®¿é—®çš„åæ ‡å¤šåŠ æ³¨æ„ï¼Œæ³¨æ„ä¸è¦å› ä¸ºçº¿æ€§æ’å€¼çš„åŸå› å¾—åˆ°é”™è¯¯çš„å€¼ï¼Œä¾‹å¦‚å½“è¦è®¿é—®åŸæœ¬æ˜¯ (i,j) çš„åæ ‡æ—¶å¯èƒ½éœ€è¦è½¬ä¸º (i+0.5f,j+0.5f)ï¼Œæˆ‘åœ¨ StackOverflow ä¸Šçœ‹åˆ°å¯¹è¿™ä¸ªç‰¹æ€§çš„è®²è§£ï¼ˆè‡ªå·±ç¿»è¯‘äº†ä¸€ä¸‹ï¼‰ï¼š</p>
<blockquote><p>åœ¨å›¾å½¢å­¦ä¸­ï¼Œçº¹ç†æŒ‡çš„æ˜¯ç”¨äºæè¿°ä¸€ä¸ªå¹³é¢çš„é‡‡æ ·ç‚¹é›†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¹ç†ä¸­çš„ä¸€ä¸ªç‚¹æŒ‡çš„å°±æ˜¯è¿™ä¸ªå¹³é¢åœ¨æ­¤å¤„çš„é‡‡æ ·ï¼Œå¹¶ä¸å­˜åœ¨å¤§å°ï¼Œè¿™å°±ä¸åƒç´ ï¼ˆPixelï¼‰ä¸åŒï¼Œä¸€ä¸ª Pixel æ˜¯å…·æœ‰ç©ºé—´å¤§å°çš„ã€‚</p>
<p>å› æ­¤ +0.5f æ“ä½œä¿è¯å¯»å€çš„ä½ç½®æ­£å¥½æ˜¯çœŸæ­£çš„æ•´æ•°ç‚¹å¯¹åº”çš„ä½ç½®ã€‚</p>
</blockquote>
<p>å¯¹äºæœ€è¿‘é‚»æ’å€¼å¾—è¿”å›å€¼å½“ç„¶æ— æ­¤é™åˆ¶ã€‚</p>
<p><strong>å¯»å€æ¨¡å¼ï¼š</strong>ä»…å¯¹ç»‘å®š CUDA æ•°ç»„çš„çº¹ç†æœ‰æ•ˆï¼Œè§„å®šäº†å½“å¯»å€çš„åæ ‡è¶…å‡ºå…è®¸çš„å¯»å€èŒƒå›´æ—¶çš„è¡Œä¸ºã€‚æœ‰é’³ä½æ¨¡å¼ä¸å¾ªç¯æ¨¡å¼ä¸¤ç§ã€‚é’³ä½æ¨¡å¼ä¸‹ï¼Œå½“å¯»å€åæ ‡è¶…å‡ºäº†è¾¹ç•Œï¼Œåˆ™é’³ä½åˆ°æœ€è¿‘è¾¹ç•Œï¼›å¾ªç¯æ¨¡å¼ä¸‹ï¼Œåˆ™æ˜¯åšæ±‚æ¨¡å¤„ç†ã€‚ä¾‹å¦‚çº¹ç†åæ ‡èŒƒå›´ [0,1)ï¼Œè®¿é—® 1.25 æ—¶ï¼Œé’³ä½æ¨¡å¼è¿”å› 0.999â€¦â€¦å¤„çš„å€¼ï¼Œå¾ªç¯æ¨¡å¼è¿”å› 0.25 å¤„çš„å€¼ã€‚</p>
<p><strong>ç±»å‹è½¬æ¢ï¼š</strong>å½“åƒå…ƒä¸­æ•°æ®æ˜¯ 8 bit æˆ–è€… 16 bit æ—¶ï¼Œå¯å¯¹æ‹¾å–çš„å€¼è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ˜ å°„åˆ° [0.0f,1.0f] æˆ–è€… [-1.0f,1.0f]ã€‚</p>
<hr>
<p><strong>è‹¥è¦ä½¿ç”¨çº¹ç†å†…å­˜ï¼Œå¤§è‡´åˆ†ä¸ºè¿™ä¹ˆå‡ æ­¥ï¼šé¦–å…ˆåœ¨ Host ç«¯å£°æ˜è¦ç»‘å®šçš„çº¿æ€§å†…å­˜æˆ–è€… CUDA æ•°ç»„ï¼›å…¶æ¬¡è®¾ç½®å¥½çº¹ç†å‚ç…§ç³»ï¼›ç„¶åå°†çº¹ç†å‚ç…§ç³»ä¸çº¿æ€§å†…å­˜æˆ–è€… CUDA æ•°ç»„ç»‘å®šï¼›æœ€ååœ¨ Kernel ä»£ç ä¸­è®¿é—®çº¹ç†å†…å­˜å³å¯ã€‚</strong></p>
<hr>
<h2>CUDA æ•°ç»„ï¼ˆArrayï¼‰</h2>
<p>æ˜¾å­˜ä¸­å¯ä»¥åˆ†é…çš„ç©ºé—´æœ‰ä¸¤ç§ï¼šçº¿æ€§å†…å­˜å’Œ CUDA æ•°ç»„ï¼Œéƒ½å¯ä»¥ä¸çº¹ç†å‚ç…§ç³»ç»‘å®šï¼Œä½†æ˜¯ CUDA æ•°ç»„å¯¹çº¹ç†æ‹¾å–æœ‰ä¼˜åŒ–ï¼Œå¹¶ä¸”åœ¨è®¾å¤‡ç«¯åªèƒ½é€šè¿‡çº¹ç†æ‹¾å–è®¿é—®ã€‚</p>
<h3>cudaChannelFormatDesc</h3>
<p>åœ¨å£°æ˜ä¸€ä¸ª CUDA æ•°ç»„å‰ï¼Œé¦–å…ˆè¦ä»¥ç»“æ„ä½“ <code>cudaChannelFormatDesc</code> è®¾ç½® CUDA æ•°ç»„çš„æ•°æ®ç±»å‹ã€‚</p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">__device_builtin__</span> <span class="n">cudaChannelFormatDesc</span>
<span class="p">{</span>
    <span class="kt">int</span>                        <span class="n">x</span><span class="p">;</span> <span class="cm">/**&lt; x */</span>
    <span class="kt">int</span>                        <span class="n">y</span><span class="p">;</span> <span class="cm">/**&lt; y */</span>
    <span class="kt">int</span>                        <span class="n">z</span><span class="p">;</span> <span class="cm">/**&lt; z */</span>
    <span class="kt">int</span>                        <span class="n">w</span><span class="p">;</span> <span class="cm">/**&lt; w */</span>
    <span class="k">enum</span> <span class="n">cudaChannelFormatKind</span> <span class="n">f</span><span class="p">;</span> <span class="cm">/**&lt; Channel format kind */</span>
<span class="p">};</span>
</pre></div>
<p>å…¶ä¸­ï¼Œ<code>x,y,z,w</code> è¡¨ç¤ºè¿”å›æ¯ä¸ªæˆå‘˜çš„ä½æ•°ï¼Œ<code>cudaChannelFormatKind</code>è¡¨ç¤ºæˆå‘˜ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå¯ä»¥å–å€¼ï¼š</p>
<p><code>cudaChannelFormatKindSigned</code>ï¼šæœ‰ç¬¦å·æ•´å‹</p>
<p><code>cudaChannelFormatKindUnsigned</code>ï¼šæ— ç¬¦å·æ•´å‹</p>
<p><code>cudaChannelFormatKindFloat</code>ï¼šæµ®ç‚¹å‹</p>
<p><code>cudaChannelFormatKindNone</code>ï¼šæ— ç±»å‹</p>
<p><code>cudaChannelFormatDesc</code> å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°æ„é€ ï¼š<code>struct cudaChannelFormatDesc cudaCreateChannelDesc(int x, int y, int z, int w, enum cudaChannelFormatKind f);</code>ã€‚åœ¨åªéœ€è¦ç±»å‹ä¿¡æ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç®€åŒ–ç‰ˆçš„ï¼š<code>struct cudaChannelFormatDesc cudaCreateChannelDesc&lt;T&gt;();</code>ã€‚</p>
<h3>cudaExtent</h3>
<p>ç„¶åéœ€è¦ç¡®å®š CUDA æ•°ç»„çš„çº¬åº¦ä¸å°ºå¯¸ã€‚çº¬åº¦ä¸å°ºå¯¸é€šè¿‡ä¸€ä¸ªç»“æ„ä½“ <code>cudaExtent</code> æè¿°ï¼š</p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">__device_builtin__</span> <span class="n">cudaExtent</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">width</span><span class="p">;</span>     <span class="cm">/**&lt; Width in elements when referring to array memory, in bytes when referring to linear memory */</span>
    <span class="kt">size_t</span> <span class="n">height</span><span class="p">;</span>    <span class="cm">/**&lt; Height in elements */</span>
    <span class="kt">size_t</span> <span class="n">depth</span><span class="p">;</span>     <span class="cm">/**&lt; Depth in elements */</span>
<span class="p">};</span>
</pre></div>
<p>æˆå‘˜åˆ†åˆ«ä»£è¡¨é•¿å®½é«˜ã€‚å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥æ„é€ ï¼š<code>struct cudaExtent make_cudaExtent(size_t w, size_t h, size_t d)</code>ã€‚</p>
<h3>ä¸º CUDA æ•°ç»„åˆ†é…ç©ºé—´</h3>
<p>CUDA æ•°ç»„å¯é€šè¿‡ <code>cudaMalloc3DArray()</code> æˆ–è€… <code>cudaMallocArray()</code> åˆ†é…ç©ºé—´ã€‚å…¶ä¸­ï¼Œ <code>cudaMalloc3DArray()</code> å¯åˆ†é…ä¸€ç»´ã€äºŒç»´ã€ä¸‰ç»´ç©ºé—´ï¼Œè€Œ <code>cudaMallocArray()</code> ä¸€èˆ¬ç”¨äºåˆ†é…äºŒç»´æ•°ç»„ã€‚ä½¿ç”¨å®Œæ•°ç»„åï¼Œéœ€è¦ä½¿ç”¨ <code>cudaFreeArray()</code> é‡Šæ”¾ç©ºé—´ã€‚</p>
<h3>æ‹·è´æ•°æ®åˆ° CUDA æ•°ç»„</h3>
<p>å¯¹æ™®é€šçº¿æ€§å†…å­˜ï¼Œä½¿ç”¨ <code>cudaMemcpy()</code>ï¼Œå¯¹ CUDA æ•°ç»„ä½¿ç”¨ <code>cudaMemcpy2D()</code>ã€<code>cudaMemcpy3D()</code>ã€‚æ³¨æ„è¿™é‡Œå¯èƒ½æ¯”è¾ƒ trickyï¼Œæ ¹æ®æ˜¾å¡çš„æ€§èƒ½å’Œèµ„æºé™åˆ¶ï¼Œæ‹·è´çš„å¤§å°ä¸èƒ½è¿‡å¤§ã€‚</p>
<h2>çº¹ç†å‚è€ƒç³»ï¼ˆTexture Referenceï¼‰</h2>
<h3>çº¹ç†å‚è€ƒç³»å£°æ˜</h3>
<p>çº¹ç†å‚è€ƒç³»ä¸­çš„æŸäº›å±æ€§éœ€è¦åœ¨ç¼–è¯‘æœŸç¡®å®šã€‚texture ç±»å‹ç»§æ‰¿è‡ª textureReferenceï¼Œç±»ä¼¼è¿™æ ·æ„é€ ï¼š<code>texture&lt;T, texType, cudaTextureReadMode&gt; tex;</code>ã€‚</p>
<p><code>T</code> æŒ‡æ˜ç”±çº¹ç†æ‹¾å–è¿”å›çš„æ•°æ®ç±»å‹ã€‚å¯ä»¥æ˜¯åŸºæœ¬æ•´å½¢ï¼Œæˆ–è€…å•ç²¾åº¦æµ®ç‚¹å‹ç»„æˆçš„ 1-ï¼Œ2-ï¼Œ4- å…ƒç»„å‘é‡ç±»å‹ã€‚</p>
<p><code>texType</code> æŒ‡æ˜äº†çº¹ç†æ’å¸ƒæ–¹å¼ã€‚å–å€¼ï¼š<code>cudaTextureType1D</code>ã€<code>cudaTextureType3D</code>ã€<code>cudaTextureType3D</code>ã€<code>cudaTextureType1DLayered</code>ã€<code>cudaTextureType2DLayered</code>ç­‰ã€‚</p>
<p><code>cudaTextureReadMode</code> å¯å–å€¼ <code>cudaReadModeNormalizedFloat</code> æˆ–è€… <code>cudaReadModeElementType</code>ï¼Œæœ¬å‚æ•°å¯é€‰ï¼Œç¼ºçœ <code>cudaReadModeElementType</code>ã€‚å½“å– <code>cudaReadModeNormalizedFloat</code> æ—¶ï¼Œè‹¥ T ä¸ºæ•´å‹ï¼Œè§† T æ˜¯å¦æœ‰ç¬¦å·åˆ™å°†è¢«æ˜ å°„åˆ° [-1.0f,1.0f]æˆ–è€… [0.0f,1.0f]ã€‚ <code>cudaReadModeElementType</code>ä¸å¯¹è¾“å‡ºè½¬æ¢ã€‚</p>
<h3>è®¾ç½®è¿è¡Œæ—¶çš„çº¹ç†å‚è€ƒç³»å±æ€§</h3>
<p>é™¤ä»¥ä¸Šéœ€è¦åœ¨ç¼–è¯‘å™¨ç¡®å®šçš„å±æ€§å¤–ï¼Œçº¹ç†å‚è€ƒç³»æœ‰å¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„å±æ€§ï¼š</p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">__device_builtin__</span> <span class="n">textureReference</span>
<span class="p">{</span>
    <span class="kt">int</span>                          <span class="n">normalized</span><span class="p">;</span>
    <span class="k">enum</span> <span class="n">cudaTextureFilterMode</span>   <span class="n">filterMode</span><span class="p">;</span>
    <span class="k">enum</span> <span class="n">cudaTextureAddressMode</span>  <span class="n">addressMode</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">cudaChannelFormatDesc</span> <span class="n">channelDesc</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<p><code>normalized</code>ï¼šè¿”å›æ˜¯å¦å½’ä¸€åŒ–ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°ã€‚å¯¹ä¸€ä¸ªåæ ‡èŒƒå›´æ˜¯ [0:N]*[0:N] çš„çº¹ç†ï¼Œå½“ä½¿ç”¨å½’ä¸€åŒ–çš„å¯»å€æ–¹å¼æ—¶ï¼Œæ¯ä¸ªç»´åº¦ä¸Šçš„åæ ‡è¢«æ˜ å°„åˆ° [0.0:1.0f) çš„èŒƒå›´ä¸­ï¼›ä½¿ç”¨éå½’ä¸€åŒ–å¯»å€æ—¶ï¼Œå°†è¢«æ˜ å°„åˆ° [0.0:N.0f) çš„èŒƒå›´å†…ã€‚</p>
<p><code>filterMode</code>ï¼šæ»¤æ³¢æ¨¡å¼ã€‚ä»…å¯¹ç»‘å®š CUDA æ•°ç»„çš„çº¹ç†æœ‰æ•ˆã€‚å½“ä½¿ç”¨æµ®ç‚¹å‹çš„åæ ‡å¯»å€çº¹ç†æ—¶ï¼Œå°†æ ¹æ®è®¾å®šè¿”å›ä¸åŒç±»å‹çš„å€¼ã€‚è®¾å®šå¯ä»¥æœ‰ï¼š<code>cudaFilterModePoint</code>å’Œ<code>cudaFilterModeLinear</code>ã€‚åˆ†åˆ«è¡¨ç¤ºæœ€è¿‘é‚»æ’å€¼ï¼ˆ<strong>å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå­˜ç–‘ã€‚æˆ‘è§‰å¾—å¥½åƒæ˜¯ç›´æ¥å¯¹æµ®ç‚¹åæ ‡åšäº† floor</strong>ï¼‰å’Œçº¿æ€§æ’å€¼ã€‚</p>
<p><code>addressMode[3]</code>ï¼šå¯»å€æ¨¡å¼ï¼Œå³å¦‚ä½•å¤„ç†è¶Šç•Œçš„çº¹ç†åæ ‡ã€‚å¯è®¾ç½®ï¼š<code>cudaAddressModeClamp</code>å’Œ<code>cudaAddressModeWrap</code>ã€‚Clamp å³é’³ä½æ¨¡å¼ï¼ŒWrap ä¸ºå¾ªç¯æ¨¡å¼ã€‚å¾ªç¯æ¨¡å¼åªæ”¯æŒå½’ä¸€åŒ–çš„çº¹ç†åæ ‡ã€‚</p>
<p><code>channelDesc</code>ï¼šæè¿°çº¹ç†è¿”å›å€¼ç±»å‹ï¼ŒåŒ CUDA æ•°ç»„éƒ¨åˆ†çš„å†…å®¹ã€‚</p>
<h3>çº¹ç†ç»‘å®š</h3>
<p>ä½¿ç”¨ <code>cudaBindTextureToArray();</code> æˆ–è€… <code>cudaBindTexture();</code> æˆ–è€… <code>cudaBindTexture2D();</code>ã€‚</p>
<p>å–æ¶ˆç»‘å®šï¼š<code>cudaUnbindTexture()</code>ã€‚</p>
<h3>çº¹ç†æ‹¾å–</h3>
<p>æ ¹æ®ä¸åŒçš„çº¹ç†ç±»å‹ï¼Œé‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥æ‹¾å–ã€‚ä¸çº¿æ€§å†…å­˜ç»‘å®šçš„çº¹ç†ï¼Œä½¿ç”¨<code>texfetch1D()</code>æ¥æ‹¾å–ï¼›å¯¹ CUDA æ•°ç»„ï¼Œä½¿ç”¨ <code>tex1D()</code>ã€<code>tex2D()</code>ã€<code>tex3D()</code>æ¥æ‹¾å–ï¼Œå¹¶ä½¿ç”¨æµ®ç‚¹åæ ‡ã€‚</p>
<h2>ä¸€ä¸ªä¾‹å­</h2>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“å‰æœ‰ä¸€ä¸ª <code>float matrix[3][4]</code> ï¼Œå°†å…¶è½½å…¥æ˜¾å­˜ï¼Œåˆ†é…ä¸º CUDA 2D æ•°ç»„ï¼Œä½œä¸ºçº¹ç†ä½¿ç”¨ï¼Œå¹¶åœ¨ kernel code ä¸­æ‹¾å–ã€‚å‡è®¾å½“å‰ matrix å·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚</p>
<h3>ä»£ç </h3>
<p>çº¹ç†å£°æ˜ï¼š</p>
<div class="highlight"><pre><span></span><span class="n">texture</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">cudaReadModeElementType</span><span class="o">&gt;</span> <span class="n">tex_mat</span><span class="p">;</span>
</pre></div>
<p>Host Codeï¼š</p>
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="n">cudaError</span> <span class="n">err</span><span class="p">;</span>
    <span class="n">cudaArray</span> <span class="o">*</span><span class="n">arr_mat</span><span class="p">;</span>
    <span class="n">cudaChannelFormatDesc</span> <span class="n">channelDesc</span> <span class="o">=</span> <span class="n">cudaCreateChannelDesc</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="n">cudaMallocArray</span><span class="p">((</span><span class="n">cudaArray</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">arr_mat</span><span class="p">,</span><span class="o">&amp;</span><span class="n">channelDesc</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">cudaMemcpyToArray</span><span class="p">(</span><span class="n">arr_mat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span> <span class="n">cudaMemcpyHostToDevice</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cudaSuccess</span> <span class="o">!=</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;CUDA ERROR : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cudaGetErrorString</span><span class="p">(</span><span class="n">err</span><span class="p">));</span>

    <span class="n">tex_mat</span><span class="p">.</span><span class="n">normalized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tex_mat</span><span class="p">.</span><span class="n">filterMode</span> <span class="o">=</span> <span class="n">cudaFilterModePoint</span><span class="p">;</span>
    <span class="c1">//tex_mat.filterMode = cudaFilterModeLinear;</span>
    <span class="n">tex_mat</span><span class="p">.</span><span class="n">addressMode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudaAddressModeClamp</span><span class="p">;</span>
    <span class="n">tex_mat</span><span class="p">.</span><span class="n">addressMode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudaAddressModeClamp</span><span class="p">;</span>
    <span class="n">tex_mat</span><span class="p">.</span><span class="n">addressMode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudaAddressModeClamp</span><span class="p">;</span>
    <span class="n">tex_mat</span><span class="p">.</span><span class="n">channelDesc</span> <span class="o">=</span> <span class="n">channelDesc</span><span class="p">;</span>

    <span class="n">err</span> <span class="o">=</span> <span class="n">cudaBindTextureToArray</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="p">(</span><span class="n">cudaArray</span><span class="o">*</span><span class="p">)</span><span class="n">arr_mat</span><span class="p">,</span><span class="n">channelDesc</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cudaSuccess</span> <span class="o">!=</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;CUDA ERROR : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cudaGetErrorString</span><span class="p">(</span><span class="n">err</span><span class="p">));</span>

    <span class="n">dim3</span> <span class="n">dimBlock</span> <span class="o">=</span> <span class="n">dim3</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">dimGrid</span> <span class="o">=</span> <span class="n">dim3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">texture_fetching</span> <span class="o">&lt;&lt;&lt;</span><span class="n">dimGrid</span><span class="p">,</span> <span class="n">dimBlock</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">();</span>

    <span class="n">err</span> <span class="o">=</span> <span class="n">cudaUnbindTexture</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cudaSuccess</span> <span class="o">!=</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;CUDA ERROR : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cudaGetErrorString</span><span class="p">(</span><span class="n">err</span><span class="p">));</span>

    <span class="n">err</span> <span class="o">=</span> <span class="n">cudaFreeArray</span><span class="p">(</span><span class="n">arr_mat</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cudaSuccess</span> <span class="o">!=</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;CUDA ERROR : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cudaGetErrorString</span><span class="p">(</span><span class="n">err</span><span class="p">));</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
<p>Kernel Codeï¼š</p>
<div class="highlight"><pre><span></span><span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">texture_fetching</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Texture Fetch:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">float</span> <span class="n">idxy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idxy</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">idxy</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">float</span> <span class="n">idxx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idxx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idxx</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%f &quot;</span><span class="p">,</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="n">idxx</span><span class="p">,</span> <span class="n">idxy</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Some other points: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>        
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tex_mat(0.1,1.0) = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">));</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tex_mat(1.4,2.0) = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">2.</span><span class="p">));</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tex_mat(0.999,2.0) = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mf">2.</span><span class="p">));</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;tex_mat(1.0,3.5) = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">tex_mat</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h3>ç»“æœ</h3>
<p>å½“ <code>tex_mat.filterMode = cudaFilterModePoint;</code> æ—¶è¾“å‡ºï¼š</p>
<p><figure class="pswp-item" style="flex: 78.75751503006012" data-width="786" data-height="499"><img src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/archives/assets/fb9a09bc92ec21f669024318c3b6779b.png" alt="filtpoint" /><figcaption>filtpoint</figcaption></figure></p>
<p>å½“ <code>tex_mat.filterMode = cudaFilterModeLinear;</code> æ—¶è¾“å‡ºï¼š</p>
<p><figure class="pswp-item" style="flex: 71.93158953722335" data-width="715" data-height="497"><img src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/archives/assets/b9df65c6b89a806ea5cfc821f99b153a.png" alt="filtlinear" /><figcaption>filtlinear</figcaption></figure></p>

            </div>
        </article>
        <div class="prism-post-meta col-md-8 offset-md-2">
    <span>ç†ŠçŒ«å°A</span>
    
    <span>/</span>
    <span>
        <a class="category no-link" href="/category/å¶å°”Geek/" target="_self">
        å¶å°”Geek
        </a>
    </span>
    
    
    
    <span>/</span>
    <span class="leancloud_visitors" id="/archives/105/" data-flag-title="CUDA ä¸­çš„æ•°ç»„(Array)ä¸çº¹ç†å­˜å‚¨(Texture)ä»‹ç»ä¸ä½¿ç”¨"><span class="leancloud-visitors-count"></span> Views</span>
    
</div>
    </section>

    
<section id="prism__pagination" class="prism-pagination" class="col-md-8 offset-md-2">
    <ul>
        
        <li class="next">
            <a class="no-link" href="/archives/107/" target="_self" title="ä¸€ç§ä½¿ç”¨ CMake å®ç° C/C++ ä¸ CUDA æ··åˆç¼–è¯‘çš„æ–¹æ³•"><i class="fa fa-chevron-left" aria-hidden="true"></i>æ›´æ–°</a>
        </li>
        
        
        <li class="prev">
            <a class="no-link" href="/archives/103/" target="_self" title="ã€Šåƒå¹´å¥³ä¼˜ã€‹ï¼šåƒæˆ‘è¿™æ ·å¯»æ‰¾çš„äºº">æ›´æ—§<i class="fa fa-chevron-right" aria-hidden="true"></i></a>
        </li>
        
    </ul>
</section>


    
    <script>
        var initValine = function() {
            new Valine({"enable": true, "el": "#vcomments", "appId": "6chFXPTjrjYnjFk9duROcboN-gzGzoHsz", "appKey": "c1CRooaFmpLs4xi7x3YLm3ma", "visitor": true, "recordIP": true, "placeholder": "\u6765\u7545\u6240\u6b32\u8a00\u5427~"});
        }

    </script>
    <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
    <div class="prism-comment-section container" id="prism__comment">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div id="vcomments"></div>
            </div>
        </div>
    </div>
    

</main>

            <footer id="prism__footer">
                <section>
                    <div>
                        <nav class="social-links">
                            <ul><li><a class="no-link" title="Twitter" href="https://twitter.com/AlanDecode" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-twitter"></i></a></li><li><a class="no-link" title="GitHub" href="https://github.com/AlanDecode" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-github"></i></a></li><li><a class="no-link" title="Weibo" href="https://weibo.com/5245109677/" target="_blank" rel="noopener noreferrer nofollow"><i class="gi gi-weibo"></i></a></li></ul>
                        </nav>
                    </div>

                    <section id="prism__external_links">
                        <ul>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://github.com/AlanDecode/Maverick" rel="noopener noreferrer nofollow">Maverick</a>ï¼šğŸ„â€ Go My Own Way.
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://www.imalan.cn" rel="noopener noreferrer nofollow">ä¸‰ç„¡è¨ˆåŠƒ</a>ï¼šä¸‰æ˜¯è™šæŒ‡ã€‚è‡³äºæ˜¯å“ªä¸‰æ— ï¼Œæˆ‘å””çŸ¥ã€‚
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://wiki.imalan.cn" rel="noopener noreferrer nofollow">ç„¡çŸ¥è­˜</a>ï¼šç†ŠçŒ«å°Açš„Wikiç«™ç‚¹ã€‚éš¶å±äºã€Œä¸‰æ— è®¡åˆ’ã€ã€‚
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://lab.imalan.cn" rel="noopener noreferrer nofollow">ç„¡é …ç›®</a>ï¼šç†ŠçŒ«å°Açš„å®éªŒå®¤ã€‚éš¶å±äºã€Œä¸‰æ— è®¡åˆ’ã€ã€‚
                                <span>|</span>
                            </li>
                            
                            <li>
                                <a class="no-link" target="_blank" href="https://t.me/triple_null" rel="noopener noreferrer nofollow">ç„¡æ¶ˆæ¯</a>ï¼šç†ŠçŒ«å°Açš„å¹¿æ’­ã€‚éš¶å±äºã€Œä¸‰æ— è®¡åˆ’ã€ã€‚
                                <span>|</span>
                            </li>
                            
                        </ul>
                    </section>

                    <div class="copyright">
                        <p class="copyright-text">
                            <span class="brand">æ— æ–‡å­— | ä¸‰æ— è®¡åˆ’</span>
                            <span>Copyright Â© 2020 ç†ŠçŒ«å°A</span>
                        </p>
                        <p class="copyright-text powered-by">
                            | Powered by <a href="https://github.com/AlanDecode/Maverick" class="no-link" target="_blank" rel="noopener noreferrer nofollow">Maverick</a> | Theme <a href="https://github.com/Reedo0910/Maverick-Theme-Prism" target="_blank" class="no-link" rel="noopener noreferrer nofollow">Prism</a>
                        </p>
                    </div>
                    <div class="footer-addon">
                        
<a no-style href="http://beian.miit.gov.cn" target="_blank">äº¬ICPå¤‡18000133å·-1</a> | 
<a no-style href="https://www.upyun.com" target="_blank">åˆæ‹äº‘</a>

                    </div>
                </section>
                <script>
                    var site_build_date = "2017-06-29T12:00+08:00"

                </script>
                <script src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/prism-a1bd79b1a4.js"></script>
            </footer>
        </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/katex.min.js"></script>
    <script>
        mathOpts = {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "\\[", right: "\\]", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false }
            ]
        };

    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/AlanDecode/site-Blog@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
<script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?e4f3a7c02ac2aabc41a1cfa95f61a026";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
</script>
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<script>
if(window.location.hash){
    var checkExist = setInterval(function() {
       if ($(window.location.hash).length) {
          $('html, body').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
          clearInterval(checkExist);
       }
    }, 100);
}
</script>
<script>
if(window.navigator && navigator.serviceWorker) {
  caches.keys().then(function(cacheNames) {
    cacheNames.forEach(function(cacheName) {
      caches.delete(cacheName);
    });
  }).then(function(){
    console.log('Cache cleaned.');
  });
  navigator.serviceWorker.getRegistrations()
  .then(function(registrations) {
    for(let registration of registrations) {
      registration.unregister();
    }
  }).then(function(){
    console.log('Service Worker stopped.');
  });
}
</script>

</body>

</html>